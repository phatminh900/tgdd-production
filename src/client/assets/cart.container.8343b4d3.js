import{r as p,m as S,n as y,j as s,a as t,k as D,L as A,e as L,Q as M,o as B,p as v,q as Q,d as P,t as H,F as $,v as N,b as V,M as z,w as G,x as R,y as I,z as J,c as F,J as q,C as K,R as W}from"./index.716acec3.js";const X="_active_xfdti_50",i={"cart-item":"_cart-item_xfdti_1","cart-item__left":"_cart-item__left_xfdti_8","cart-item__info":"_cart-item__info_xfdti_20","cart-item__img-box":"_cart-item__img-box_xfdti_24","cart-item__btn-remove":"_cart-item__btn-remove_xfdti_28","cart-item__img":"_cart-item__img_xfdti_24","cart-item__promotion-list":"_cart-item__promotion-list_xfdti_40",active:X,"cart-item__btn-promotion":"_cart-item__btn-promotion_xfdti_53","cart-item__btn-color":"_cart-item__btn-color_xfdti_60","cart-item__colors":"_cart-item__colors_xfdti_63","cart-item__colors-list":"_cart-item__colors-list_xfdti_66","cart-item__right":"_cart-item__right_xfdti_122"},Y=(r,e)=>{const[c,a]=p.exports.useState(e||1),[n,l]=p.exports.useState(!1),[u,m]=p.exports.useState(!1),o=S();return{quantity:c,changeQuantityItem:_=>{a(_),o(y.changeCurrentQuantityProduct({id:r,quantity:_}))},isOpenPromotionList:n,isOpenColorList:u,changeCurrentColor:_=>{o(y.changeCurrentColorProduct({id:r,color:_})),m(!1)},togglePromotionList:()=>l(_=>!_),removeItem:()=>{o(y.removeFromCart({id:r}))},toggleColorList:()=>m(_=>!_)}},Z=({currentProductColor:r,color:e,imgSrc:c,changeCurrentColor:a})=>s("li",{onClick:()=>a(e),className:`${i["cart-item__colors-item"]} ${r===e&&i.active} flex-vt-ct`,children:[t("img",{src:c,alt:"product color"}),t("p",{"data-testid":"cart-item-color",children:e})]}),tt=({isOpenColorList:r,imgColorsCover:e,changeCurrentColor:c,currentColor:a,colors:n})=>t("ul",{"data-testid":"cart-item-color-list",className:`${i["cart-item__colors-list"]} ${r&&i.active}`,children:e.map((l,u)=>t(Z,{color:n[u],imgSrc:l,changeCurrentColor:c,currentProductColor:a},l))}),et=({toggleColorList:r,currentColor:e})=>s("button",{className:`${i["cart-item__btn-color"]} gap-6px flex-vt-ct`,onClick:r,children:["M\xE0u:",e," ",t(D,{})]}),rt=({isOpenPromotionList:r,promotion:e,togglePromotionList:c})=>s("div",{className:`${i["cart-item__promotion"]} `,children:[t("ul",{className:`${i["cart-item__promotion-list"]} ${r&&i.active}`,children:e==null?void 0:e.map(a=>t("li",{children:a},a))}),s("button",{className:`${i["cart-item__btn-promotion"]} ${r&&i.active} flex-vt-ct`,onClick:c,children:[r?"Thu g\u1ECDn":e!=null&&e.length?`Xem  ${e.length} khuy\u1EBFn m\xE3i`:"",e!=null&&e.length?t(D,{}):""]})]}),at=({link:r,currentColorImgCover:e,removeItem:c})=>s("div",{className:`${i["cart-item__img-box"]} flex-vt-ct gap-12px`,children:[t(A,{to:r,children:t("img",{"data-testid":"cart-item-img-cover",className:i["cart-item__img"],src:e,alt:"Product"})}),t("button",{onClick:c,className:i["cart-item__btn-remove"],children:"\xD7"})]}),ct=({currentColor:r,title:e,link:c,quantity:a,price:n,imgColorsCover:l,currentColorImgCover:u,colors:m,id:o,promotion:d})=>{const{quantity:x,changeQuantityItem:h,isOpenPromotionList:C,isOpenColorList:g,changeCurrentColor:_,togglePromotionList:k,removeItem:T,toggleColorList:U}=Y(o,a);return s("li",{"data-testid":`cart-item-container-${o}`,className:i["cart-item"],children:[t("div",{className:i["cart-item__left"],children:s("div",{className:`${i["cart-item__info"]} flex`,children:[t(at,{removeItem:T,link:c,currentColorImgCover:u}),s("div",{children:[t(A,{to:c,children:t("h4",{children:e})}),t(rt,{togglePromotionList:k,promotion:d,isOpenPromotionList:C}),s("div",{className:i["cart-item__colors"],children:[t(et,{toggleColorList:U,currentColor:r}),t(tt,{isOpenColorList:g,colors:m,currentColor:r,changeCurrentColor:_,imgColorsCover:l})]})]})]})}),s("div",{className:i["cart-item__right"],children:[t(L,{price:n}),t(M,{quantity:x,changeQuantityItem:h})]})]})},O=()=>B(e=>e.cart.cart),st={},nt=()=>{const r=O();return t("ul",{"data-testid":"cart-list",className:st.cart__list,children:r.map(e=>t(ct,{...e},e.id+e.currentColor))})},it="_cart_31i8j_13",ot="_cart__header_31i8j_29",lt="_cart__body_31i8j_38",b={cart:it,cart__header:ot,cart__body:lt,"cart__user-login":"_cart__user-login_31i8j_50"},_t=()=>({totalPrice:v().cart.reduce((c,a)=>a.price*a.quantity+c,0)}),ut="_summary_m7hyq_1",dt="_total_m7hyq_5",w={summary:ut,total:dt},mt=({checkout:r})=>{const e=v(),{totalPrice:c}=_t();return s("div",{"data-testid":"cart-summary-container",className:w.summary,children:[s("div",{className:`${w.total} flex-vt-ct`,children:[t("p",{className:"text-bold",children:"T\u1ED5ng ti\u1EC1n "}),t(L,{price:e.priceAfterApplyingDiscount||c})]}),t(Q,{text:"Mua ngay",onClick:r})]})},ht="_cart__form_1axne_6",f={"cart__user-info":"_cart__user-info_1axne_1",cart__form:ht,"cart__input-error":"_cart__input-error_1axne_27"},gt=()=>{var m;const r=(m=P())==null?void 0:m.user,e=S(),c=B(H),{userAddress:a}=v(),[n,l]=p.exports.useState(a||"");return{user:r,address:n,setUserAddress:o=>{const{value:d}=o.target;e(y.setUserAddress({address:d})),l(d)},appState:c}},pt=()=>{const{user:r,address:e,setUserAddress:c,appState:a}=gt();return r?s("div",{className:f["cart__user-info"],children:[t("p",{children:"Th\xF4ng tin kh\xE1ch h\xE0ng"}),s("form",{"data-error-msg":a.error,className:`${f.cart__form} gap-12px`,children:[s($,{children:[t(N,{type:"text",label:"name",id:"user-name",value:r.name,className:` ${a.error&&!r.name&&f["cart__input-error"]}`}),t(N,{className:`${f["cart__user-email-input"]} ${a.error&&!r.email&&f["cart__input-error"]}`,disable:!0,value:r.email,label:"Email",id:"user-login-email",type:"email"})]}),t(N,{onChange:c,className:a.error&&!e?f["cart__input-error"]:"",label:"Address",id:"address",value:e,type:"text"})]})]}):null},xt="_cart__nothing_pk44j_1",j={cart__nothing:xt,"cart__nothing--details":"_cart__nothing--details_pk44j_5"},Ct=()=>{const r=V();return t("div",{className:j.cart__nothing,children:s("div",{className:j["cart__nothing--details"],children:[t(z,{}),t("p",{children:"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m n\xE0o trong gi\u1ECF h\xE0ng"}),t("button",{className:"btn--border-blue",onClick:()=>r("/"),children:"V\u1EC1 trang ch\u1EE7"})]})})},ft="_cart__discount_1wr2l_1",E={cart__discount:ft,"cart__btn-control":"_cart__btn-control_1wr2l_6","cart__discount-box":"_cart__discount-box_1wr2l_12","cart__btn-apply":"_cart__btn-apply_1wr2l_32"};function vt(r){return G({tag:"svg",attr:{viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"desc",attr:{},child:[]},{tag:"path",attr:{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}},{tag:"line",attr:{x1:"9",y1:"15",x2:"15",y2:"9"}},{tag:"circle",attr:{cx:"9.5",cy:"9.5",r:".5",fill:"currentColor"}},{tag:"circle",attr:{cx:"14.5",cy:"14.5",r:".5",fill:"currentColor"}},{tag:"path",attr:{d:"M5 7.2a2.2 2.2 0 0 1 2.2 -2.2h1a2.2 2.2 0 0 0 1.55 -.64l.7 -.7a2.2 2.2 0 0 1 3.12 0l.7 .7a2.2 2.2 0 0 0 1.55 .64h1a2.2 2.2 0 0 1 2.2 2.2v1a2.2 2.2 0 0 0 .64 1.55l.7 .7a2.2 2.2 0 0 1 0 3.12l-.7 .7a2.2 2.2 0 0 0 -.64 1.55v1a2.2 2.2 0 0 1 -2.2 2.2h-1a2.2 2.2 0 0 0 -1.55 .64l-.7 .7a2.2 2.2 0 0 1 -3.12 0l-.7 -.7a2.2 2.2 0 0 0 -1.55 -.64h-1a2.2 2.2 0 0 1 -2.2 -2.2v-1a2.2 2.2 0 0 0 -.64 -1.55l-.7 -.7a2.2 2.2 0 0 1 0 -3.12l.7 -.7a2.2 2.2 0 0 0 .64 -1.55v-1"}}]})(r)}const yt=()=>{const r=S(),e=v(),a=e.cart[0].discount,[n,l]=p.exports.useState(!0),[u,m]=p.exports.useState(0),[o,d]=p.exports.useState(e.discountCode||""),[x,h]=p.exports.useState(!1),C=g=>{g.preventDefault();const _=a==null?void 0:a.find(k=>k.code===o);if(!_)return l(!1);l(!0),m(_.discount),r(y.applyDiscount({discountCode:o,discount:_.discount}))};return s("div",{className:E.cart__discount,children:[s("button",{onClick:()=>h(g=>!g),className:`${E["cart__btn-control"]} flex-vt-ct gap-8px`,children:[t(vt,{})," S\u1EED d\u1EE5ng m\xE3 gi\u1EA3m gi\xE1"," ",x?t(R,{}):t(D,{})]}),t("form",{"data-invalid-discount":n?"":"Invalid discount",onSubmit:C,className:`${E["cart__discount-box"]} flex gap-12px`,children:x&&s($,{children:[t(N,{id:"Discount-place",label:u&&n?`Gi\u1EA3m ${u}%`:"Nh\u1EADp m\xE3 gi\u1EA3m gi\xE1",value:o,onChange:g=>d(g.target.value),type:"text"}),t("div",{children:t("button",{className:E["cart__btn-apply"],type:"submit",children:"Apply"})})]})})]})},bt=()=>{const r=O(),e=r.reduce((a,n)=>a+n.quantity,0),c=r.reduce((a,n)=>a+n.price*n.quantity,0);return{totalProducts:e,totalPrice:c}},Et="_cart__summary_h8sjf_1",Nt={cart__summary:Et},At=()=>{const{totalProducts:r,totalPrice:e}=bt();return s("div",{className:`${Nt.cart__summary} flex-vt-ct`,children:[s("p",{children:["T\u1EA1m t\xEDnh (",r,") s\u1EA3n ph\u1EA9m:"]}),t(L,{price:e})]})},$t=()=>{var o;const r=v().cart,e=(o=P())==null?void 0:o.user,c=v(),a=S(),{discount:n,userAddress:l}=c,u=e?e._id:null;return{cart:r,checkout:async()=>{try{if(!l)return a(I.setError("Please fill up all the fields."));const{data:d}=await J.post("/api/v1/booking/create-checkout-session",{cart:r,discount:n,userAddress:l,userId:u},{headers:{Authorization:`Bearer ${F.get(q)}`}});a(I.resetState()),window.location.href=d.session.url}catch(d){const x=d,{response:h}=x,C=(h==null?void 0:h.data.message)||"something went wrong";a(I.setError(C))}}}},kt=()=>{var n;const r=(n=P())==null?void 0:n.user,{cart:e,checkout:c}=$t(),a=s($,{children:[s("div",{className:`${b.cart__header} flex-vt-ct`,children:[s(A,{to:"/",children:[t(K,{})," Xem th\xEAm s\u1EA3n ph\u1EA9m kh\xE1c"]}),t("p",{children:"Your cart"})]}),s("div",{className:b.cart__body,children:[t(nt,{}),t(At,{}),r&&F.get(q)?s($,{children:[t(pt,{}),t(yt,{}),t(mt,{checkout:c})]}):s("div",{className:b["cart__user-login"],children:[t("p",{children:"Please login first to purchase."}),t(A,{to:W.LOGIN,children:"Login Here"})]})]})]});return t("div",{className:b.cart,children:e.length?a:t(Ct,{})})};export{kt as default};
